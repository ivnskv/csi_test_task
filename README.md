# CSI test task

## Условие задачи

Используя язык Java необходимо написать метод объединения имеющихся цен с вновь импортированными из внешней системы. Также необходимо написать unit тесты, для проверки хотя бы некоторых возможных вариантов.
  
Каждый продаваемый товар, имеет свою цену. Цен у товара может быть несколько, каждая цена имеет свой номер, принадлежность к отделу, период действия и значение в валюте.

В базе данных для каждого товара хранится история цен. **В один момент времени может действовать только одна цена из цен, с одинаковым номером и отделом.** Обычно товар продается по первой цене, вторая, третья и четвертая могут используются для применения скидок (т.е. сработало условие скидки, товар будет продан по цене номер 2). Касса может обслуживать какой-то отдел, тогда она будет использовать при продаже цены указанные для этого отдела.  
  
Правила объединения цен:
- если товар еще не имеет цен, или имеющиеся цены не пересекаются в периодах действия с новыми, то новые цены просто добавляются к товару;
- если имеющаяся цена пересекается в периоде действия с новой ценой, то:
     * если значения цен одинаковы, период действия имеющейся цены увеличивается согласно периоду новой цены;
     * если значения цен отличаются, добавляется новая цена, а период действия старой цены уменьшается согласно периоду новой цены.

Метод в качестве параметров получает коллекцию имеющихся цен, новых цен и должен вернуть коллекцию объединенных цен, для дальнейшего сохранения в БД. 

Пример полей класса «цена»:
```
long id; // идентификатор в БД
String productCode; // код товара
int number; // номер цены
int depart; // номер отдела
Date begin; // начало действия
Date end; // конец действия
long value; // значение цены в копейках
```

Примеры объединений:

Имеющиеся цены

productCode | number | depart | begin | end | value |
--- | --- | --- | --- | --- | --- |
122856 | 1 | 1 | 2013-01-01T00:00:00.000+03:00 | 2013-01-31T23:59:59.999+03:00 | 11000
122856 | 2 | 1 | 2013-01-10T00:00:00.000+03:00 | 2013-01-20T23:59:59.999+03:00 | 99000
6654 | 1 | 2 | 2013-01-01T00:00:00.000+03:00 | 2013-01-31T00:00:00.000+03:00 | 5000

Новые цены

productCode | number | depart | begin | end | value |
--- | --- | --- | --- | --- | --- |
122856 | 1 | 1 | 2013-01-20T00:00:00.000+03:00 | 2013-02-20T23:59:59.999+03:00 | 11000
122856 | 2 | 1 | 2013-01-15T00:00:00.000+03:00 | 2013-01-25T23:59:59.999+03:00 | 92000
6654 | 1 | 2 | 2013-01-12T00:00:00.000+03:00 | 2013-01-12T23:59:59.999+03:00 | 4000


Результат

productCode | number | depart | begin | end | value |
--- | --- | --- | --- |--- |--- |
122856 | 1 | 1 | 2013-01-01T00:00:00.000+03:00 | 2013-02-20T23:59:59.999+03:00 | 11000
122856 | 2 | 1 | 2013-01-10T00:00:00.000+03:00 | 2013-01-14T23:59:59.999+03:00 | 99000
122856 | 2 | 1 | 2013-01-15T00:00:00.000+03:00 | 2013-01-25T23:59:59.999+03:00 | 92000
6654 | 1 | 2 | 2013-01-01T00:00:00.000+03:00 | 2013-01-11T23:59:59.999+03:00 | 5000
6654 | 1 | 2 | 2013-01-12T00:00:00.000+03:00 | 2013-01-12T23:59:59.999+03:00 | 4000
6654 | 1 | 2 | 2013-01-13T00:00:00.000+03:00 | 2013-01-31T23:59:59.999+03:00 | 5000